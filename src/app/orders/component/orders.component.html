<desktop>
  <div class="mb-4">
    <nz-space>
      <button *nzSpaceItem
              [nzDropdownMenu]="menu"
              nz-button
              nz-dropdown
              nzPlacement="bottomLeft">Selected Columns
      </button>
      <nz-space *nzSpaceItem nzAlign="center">
        <label *nzSpaceItem>Page Size:</label>
        <nz-select (ngModelChange)="changePageSize($event)" *nzSpaceItem [ngModel]="currentPageSize()"
                   nzPlaceHolder="Page Size">
          @for (pageSize of [20, 35, 50, 100]; track $index) {
            <nz-option [nzLabel]="pageSize" [nzValue]="pageSize" [nzKey]="pageSize"></nz-option>
          }
        </nz-select>
      </nz-space>
      <nz-space *nzSpaceItem nzAlign="center">
        <label *nzSpaceItem>Auto Reload Interval:</label>
        <nz-select (ngModelChange)="changeAutoReloadInterval($event)" *nzSpaceItem
                   [ngModel]="selectedAutoReloadInterval()"
                   nzPlaceHolder="Auto Reload Interval">
          @for (interval of [1000, 2000, 3000, 5000, 10000]; track $index) {
            <nz-option [nzLabel]="interval" [nzValue]="interval" [nzKey]="interval"></nz-option>
          }
        </nz-select>
      </nz-space>
    </nz-space>
  </div>
  <nz-table (nzPageIndexChange)="changePageIndex($event)"
            [nzData]="ordersData"
            [nzLoadingDelay]="1000"
            [nzLoading]="isOrdersLoading$ | async"
            [nzPageIndex]="currentPage()"
            [nzPageSizeOptions]="[20,50,100]"
            [nzPageSize]="currentPageSize()"
            [nzShowPagination]="true"
            [nzShowQuickJumper]="true"
            nzBordered
            nzOuterBordered
            nzShowSizeChanger>
    <thead>
    <tr>
      <th [class.hidden]="!orderTableHeader.get('currency')">Currency</th>
      <th [class.hidden]="!orderTableHeader.get('spotAction')">Action</th>
      <th [class.hidden]="!orderTableHeader.get('amount')">Volume</th>
      <th [class.hidden]="!orderTableHeader.get('fee')">Fee</th>
      <th [class.hidden]="!orderTableHeader.get('quoteAmountUsed')">Quote Amount Used</th>
      <th [class.hidden]="!orderTableHeader.get('spotTarget')">Target</th>
      <th [class.hidden]="!orderTableHeader.get('providerOrderId')">Order Id</th>
      <th [class.hidden]="!orderTableHeader.get('status')">Status</th>
      <th [class.hidden]="!orderTableHeader.get('createdAt')">Created At</th>
      <th [class.hidden]="!orderTableHeader.get('canceledAt')">Canceled At</th>
      <th [class.hidden]="!orderTableHeader.get('filledAt')">Filled At</th>
      <th [class.hidden]="!orderTableHeader.get('placedAt')">Placed At</th>
    </tr>
    </thead>
    <tbody>
      @for (order of ordersData; track $index) {
        <tr>
          <td [class.hidden]="!orderTableHeader.get('currency')">
            <img [ngSrc]="order.currencyLogo ?? 'not found'" width="24" height="24" alt="currency logo"
                 class="me-2 align-middle overflow-clip rounded-full object-cover inline-block">
            <span>{{ order.currency }}</span>
          </td>
          <td [class.hidden]="!orderTableHeader.get('spotAction')">{{ order.spotAction }}</td>
          <td [class.hidden]="!orderTableHeader.get('amount')">{{ order.amount | number: '1.2-8' }}</td>
          <td [class.hidden]="!orderTableHeader.get('fee')">{{ order.fee | number: '1.2-8' }}</td>
          <td [class.hidden]="!orderTableHeader.get('quoteAmountUsed')">{{ order.quoteAmountUsed | number: '1.2-10' }}
          </td>
          <td [class.hidden]="!orderTableHeader.get('spotTarget')">{{ order.spotTarget | number: '1.2-8' }}</td>
          <td [class.hidden]="!orderTableHeader.get('providerOrderId')">{{ order.providerOrderId }}</td>
          <td [class.hidden]="!orderTableHeader.get('status')" [ngClass]="{
              'text-teal-500': order.status === 'FILLED',
              'text-rose-400': order.status === 'CANCELED',
              'text-amber-500': order.status === 'PLACED',
              'text-orange-500': order.status === 'PENDING_PLACEMENT',
            }">
            <i class="fa-solid me-2" [ngClass]="{
              'fa-circle-check': order.status === 'FILLED',
              'fa-circle-xmark': order.status === 'CANCELED',
              'fa-hourglass': order.status === 'PLACED',
              'fa-spinner animate-spin': order.status === 'PENDING_PLACEMENT',
            }"></i>
            <span>{{ order.status }}</span>
          </td>
          <td [class.hidden]="!orderTableHeader.get('createdAt')">{{ order.createdAt | fixedDate }}</td>
          <td [class.hidden]="!orderTableHeader.get('canceledAt')">{{ order.canceledAt | fixedDate }}
          </td>
          <td [class.hidden]="!orderTableHeader.get('filledAt')">{{ order.filledAt | fixedDate }}</td>
          <td [class.hidden]="!orderTableHeader.get('placedAt')">{{ order.placedAt | fixedDate }}</td>
        </tr>
      }
    </tbody>
  </nz-table>
</desktop>
<mobile>
  <nz-space nzDirection="vertical" nzSize="middle" style="display: block">
    @for (order of ordersData; track $index) {
      <nz-card *nzSpaceItem [nzTitle]="cardTitle" [nzExtra]="cardExtra">
        <nz-card-meta
          [nzDescription]="cardDescription"
        ></nz-card-meta>
        <ng-template #cardTitle>
          <img [ngSrc]="order.currencyLogo ?? 'not found'" width="24" height="24"
               class="inline-block align-middle w-6 h-6 object-cover overflow-clip rounded-full" alt="currency logo">
          <strong class="ms-2">{{ order.currency }}</strong>
        </ng-template>
        <ng-template #cardExtra>
          <strong
            [ngClass]="{'text-teal-500': order.spotAction === 'SPOTBUY', 'text-rose-400': order.spotAction === 'SPOTSELL'}">{{ order.spotAction }}</strong>
        </ng-template>
        <ng-template #cardDescription>
          <div [ngClass]="{
              'text-teal-500': order.status === 'FILLED',
              'text-rose-400': order.status === 'CANCELED',
              'text-amber-500': order.status === 'PLACED',
              'text-orange-500': order.status === 'PENDING_PLACEMENT',
            }">
            <i class="fa-solid me-2" [ngClass]="{
              'fa-circle-check': order.status === 'FILLED',
              'fa-circle-xmark': order.status === 'CANCELED',
              'fa-hourglass': order.status === 'PLACED',
              'fa-spinner animate-spin': order.status === 'PENDING_PLACEMENT',
            }"></i>
            <span>{{ order.status }}</span>
          </div>
        </ng-template>
        <div class="mt-4" nz-row nzJustify="space-around">
          <div nz-col nzSpan="12">
            <div class="mb-1">
              <i class="me-2 fa-solid fa-square-plus"></i>
              <span>{{ order.createdAt | fixedDate }}</span>
            </div>
          </div>
          <div nz-col nzSpan="12">
            <div class="mb-1">
              <i class="me-2 fa-solid fa-xmark-circle"></i>
              <span>{{ order.canceledAt | fixedDate }}</span>
            </div>
          </div>
          <div nz-col nzSpan="12">
            <div class="mb-1">
              <i class="me-2 fa-solid fa-fill"></i>
              <span>{{ order.filledAt | fixedDate }}</span>
            </div>
          </div>
          <div nz-col nzSpan="12">
            <div class="mb-1">
              <i class="me-2 fa-solid fa-location-crosshairs"></i>
              <span>{{ order.placedAt | fixedDate }}</span>
            </div>
          </div>
        </div>
      </nz-card>
    }
  </nz-space>
</mobile>
<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu>
    <nz-space nzDirection="vertical">
      @for (column of orderTableHeader.entries(); track $index) {
        <li *nzSpaceItem>
          <label nz-checkbox [ngModel]="column[1]"
                 (ngModelChange)="changeColumnVisibility($event, column[0])">{{ column[0] }}</label>
        </li>
      }
    </nz-space>
  </ul>
</nz-dropdown-menu>
